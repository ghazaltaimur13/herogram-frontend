"use strict";(self.webpackChunkherogram_test_frontend=self.webpackChunkherogram_test_frontend||[]).push([[865],{3465:(e,i,r)=>{r.d(i,{Q:()=>s});const s={LOGIN:"/login",UPLOAD_FILE:"/uploadFile",READ_FILE:"/readFiles",TRACK_FILE:"/trackFiles",SIGNUP:"/signup"}},8246:(e,i,r)=>{r.r(i),r.d(i,{default:()=>T});var s=r(5043),n=r(4281),t=r(8911),o=r(9252),a=r(1596),l=r(5865),d=r(7353),c=r(8903),h=r(2110),x=r(6591),p=r(6494),u=r(2505),g=r(7392),A=r(1906),j=r(1637),m=r(4194),f=r(3768),v=r(9506),F=r(3438),y=r(3465);const E=r(6749).l.injectEndpoints({endpoints:e=>({uploadFile:e.mutation({query:e=>({url:`${y.Q.UPLOAD_FILE}`,method:"POST",body:e}),transformResponse:e=>e}),getFiles:e.query({query:()=>`${y.Q.READ_FILE}`}),trackFile:e.mutation({query:e=>({url:`${y.Q.TRACK_FILE}`,method:"POST",body:{fileId:e}})})})}),{useUploadFileMutation:L,useGetFilesQuery:w,useTrackFileMutation:k}=E;var b=r(8076),U=r(39),I=r(9650),R=r(1806),S=r(4882),D=r(3460),C=r(579);const _=e=>{var i;let{uploadedFiles:r,isLoading:s,fetchError:n,isFetchError:t,setRefreshFiles:o}=e;const[c]=k(),h=r.map((e=>(0,C.jsxs)(b.A,{children:[(0,C.jsx)(U.A,{children:e.filename}),(0,C.jsx)(U.A,{children:e.tags.join(", ")}),(0,C.jsx)(U.A,{children:new Date(e.uploadedAt).toLocaleString()}),(0,C.jsx)(U.A,{children:e.views}),(0,C.jsx)(U.A,{children:(0,C.jsx)(A.A,{onClick:i=>{i.preventDefault(),(async(e,i)=>{try{await c(e).unwrap(),o((e=>!e)),window.open(i,"_blank","noopener,noreferrer")}catch(r){console.error("Failed to track file view:",r)}})(e.id,e.url)},sx:{textDecoration:"underline",color:"primary.main",background:"none",padding:0,"&:hover":{textDecoration:"underline"}},children:"View File"})})]},e.id)));return(0,C.jsxs)(I.A,{component:a.A,sx:{marginTop:4,maxWidth:{xs:"100%",sm:"80%"}},children:[(0,C.jsx)(l.A,{variant:"h6",align:"center",gutterBottom:!0,sx:{padding:"2rem"},children:"Uploaded Files"}),s?(0,C.jsx)(d.A,{display:"flex",justifyContent:"center",alignItems:"center",sx:{minHeight:"150px"},children:(0,C.jsx)(j.A,{})}):t&&n?(0,C.jsx)(m.A,{icon:(0,C.jsx)(v.A,{fontSize:"inherit"}),severity:"error",children:(null===n||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Failed to load files."}):(0,C.jsxs)(R.A,{children:[(0,C.jsx)(S.A,{children:(0,C.jsxs)(b.A,{sx:{backgroundColor:"#ccc"},children:[(0,C.jsx)(U.A,{children:"File Name"}),(0,C.jsx)(U.A,{children:"Tags"}),(0,C.jsx)(U.A,{children:"Upload Date"}),(0,C.jsx)(U.A,{children:"File Views"}),(0,C.jsx)(U.A,{children:"Shareable Link"})]})}),(0,C.jsxs)(D.A,{children:[h," "]})]})]})},T=()=>{var e;const[i,r]=(0,s.useState)([]),[y,E]=(0,s.useState)([]),[k,b]=(0,s.useState)(!1),{data:U,error:I,isLoading:R,isError:S,refetch:D}=w(),[T,{isError:O,error:P,isSuccess:W,isLoading:z}]=L();(0,s.useEffect)((()=>{U&&E(U)}),[U]),(0,s.useEffect)((()=>{D()}),[k,D]);(0,s.useEffect)((()=>()=>{i.forEach((e=>URL.revokeObjectURL(e.preview)))}),[i]);const{getRootProps:Q,getInputProps:q}=(0,n.VB)({onDrop:e=>{const i=e.map((e=>({file:e,preview:URL.createObjectURL(e),tags:""})));r((e=>[...e,...i]))},accept:"image/*,video/*"});return(0,C.jsxs)(t.A,{direction:"column",alignItems:"center",justifyContent:"center",sx:{minHeight:{xs:"calc(100vh)",paddingTop:"1rem"}},children:[(0,C.jsx)(o.A,{component:"main",maxWidth:"xs",children:(0,C.jsxs)(a.A,{elevation:3,sx:{padding:3},children:[(0,C.jsx)(l.A,{variant:"h4",align:"center",gutterBottom:!0,children:"File Upload with Tags"}),(0,C.jsxs)(d.A,{...Q({className:"dropzone"}),sx:{border:"2px dashed #0087f7",borderRadius:"5px",padding:"20px",textAlign:"center",cursor:"pointer",marginBottom:"20px"},children:[(0,C.jsx)("input",{...q()}),(0,C.jsx)(l.A,{variant:"body1",children:"Drag 'n' drop some files here, or click to select files"})]}),(0,C.jsx)(c.Ay,{container:!0,spacing:2,children:i.map(((e,s)=>(0,C.jsx)(c.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,C.jsxs)(h.A,{children:[(0,C.jsx)(x.A,{component:e.file.type.startsWith("image/")?"img":"video",src:e.preview,controls:!e.file.type.startsWith("image/"),height:"140",alt:e.file.name}),(0,C.jsxs)(p.A,{children:[(0,C.jsx)(u.A,{fullWidth:!0,label:"Add tags",value:e.tags,onChange:e=>((e,s)=>{const n=[...i];n[e].tags=s.target.value,r(n)})(s,e)}),(0,C.jsx)(g.A,{onClick:()=>(e=>{const s=i.filter(((i,r)=>r!==e));r(s)})(s),color:"error","aria-label":"delete",children:(0,C.jsx)(f.A,{})})]})]})},s)))}),(0,C.jsx)(A.A,{variant:"contained",color:"primary",onClick:async()=>{const e=new FormData;i.forEach(((i,r)=>{e.append("files",i.file),e.append(`tags[${r}]`,i.tags)}));try{(await T(e).unwrap()).message&&(D(),r([]))}catch(I){console.error("Error uploading files:",I)}},fullWidth:!0,sx:{marginTop:2},startIcon:z&&(0,C.jsx)(j.A,{size:16}),disabled:z||0===i.length,children:z?"Uploading...":"Upload Files"}),O&&(0,C.jsx)(m.A,{icon:(0,C.jsx)(F.A,{fontSize:"inherit"}),severity:"error",children:(null===P||void 0===P||null===(e=P.data)||void 0===e?void 0:e.message)||"Failed to upload files."}),W&&(0,C.jsx)(m.A,{icon:(0,C.jsx)(v.A,{fontSize:"inherit"}),severity:"success",children:"Uploaded Successfully"})]})}),R?(0,C.jsx)(j.A,{}):(0,C.jsx)(_,{uploadedFiles:y,isLoading:R,fetchError:I,isFetchError:S,setRefreshFiles:b})]})}}}]);
//# sourceMappingURL=865.3ed31935.chunk.js.map